%%%-------------------------------------------------------------------
%%% @copyright
%%% @end
%%%-------------------------------------------------------------------
%%% @author Sukumar Yethadka <sukumar@thinkapi.com>
%%%
%%% @doc DB wrapper, interface for DB requests
%%%
%%% The DB module consists of a supervised worker that manages and runs
%%% commands on the specified backend
%%% @end
%%%
%%% @since : 30 May 2012 by Wooga GmbH
%%% @end
%%%-------------------------------------------------------------------
-module(db).

%% -----------------------------------------------------------------
%% Public interface
%% -----------------------------------------------------------------
-export([ping/0, get/1, put/2, delete/1]).

%% -----------------------------------------------------------------
%% Private macros
%% -----------------------------------------------------------------
-define(CALL_WORKER(Cmd), try gen_server:call(db_worker, Cmd)
                          catch
                              exit:{timeout, _} -> {error, timeout}
                          end).

%% -----------------------------------------------------------------
%% Public functions
%% -----------------------------------------------------------------

%%-------------------------------------------------------------------
%% @doc
%% Check if DB is up.
%%-------------------------------------------------------------------
-spec ping() -> pong | pang.
ping() ->
    ?CALL_WORKER(ping).

%%-------------------------------------------------------------------
%% @doc
%% Get a value from the DB.
%%-------------------------------------------------------------------
get(Key) ->
    ?CALL_WORKER({get, Key}).
    
%%-------------------------------------------------------------------
%% @doc
%% Store an object in the database.
%%-------------------------------------------------------------------
put(Key, Value) ->
    ?CALL_WORKER({put, {Key, Value}}).

%%-------------------------------------------------------------------
%% @doc
%% Deletes object with given key from the database.
%%-------------------------------------------------------------------
delete(Key) ->
    ?CALL_WORKER({delete, Key}).
